# Copyright 2020 ChainSafe Systems
# SPDX-License-Identifier: LGPL-3.0-only
version: '3'

services:
  evm1:
    build:
      context: ../geth-build
      dockerfile: Dockerfile
    container_name: evm1
    networks:
      - evm1
    ports:
      - "8645:8545"
      - "8646:8546"
    environment:
      - NODEKEY=98ab333347a12cef869f92b3de44085f9e44891e513bcf1d76a99eecbcdd5e17
      - NETWORKID=421
      - MINE=true
    entrypoint: "/root/entrypoint.sh"

  # SECOND CHAIN is currently being generated by a separate docker compose that generates a local optimism stack (original copied from optimism/ops)

  # ALL KEYS USED IN THE KEYSTORE BELOW ARE PUBLIC INFO, DO NOT SEND FUNDS TO THEM ON MAINNET
  relayer1:
    container_name: relayer1-evm-optimism
    build:
      context: ../../.
      dockerfile: Dockerfile.evm-optimism
    command: run --config /cfg/config_evm-optimism.json --keystore /keys --fresh
    depends_on:
      - evm1
      # - l2geth
      # - verifier
    networks:
      - evm1
    volumes:
      - ./example/cfg/relayer1:/cfg
      - ./example/testkeys:/keys
    environment:
      - KEYSTORE_PASSWORD=passwordpassword

  relayer2:
    container_name: relayer2-evm-optimism
    build:
      context: ../../.
      dockerfile: Dockerfile.evm-optimism
    command: run --config /cfg/config_evm-optimism.json --keystore /keys --fresh
    depends_on:
      - evm1
      # - l2geth
      # - verifier
    networks:
      - evm1
    volumes:
      - ./example/cfg/relayer2:/cfg
      - ./example/testkeys:/keys
    environment:
        - KEYSTORE_PASSWORD=passwordpassword

  relayer3:
    container_name: relayer3-evm-optimism
    build:
      context: ../../.
      dockerfile: Dockerfile.evm-optimism
    command: run --config /cfg/config_evm-optimism.json --keystore /keys --fresh
    depends_on:
      - evm1
      # - l2geth
      # - verifier
    networks:
      - evm1
    volumes:
      - ./example/cfg/relayer3:/cfg
      - ./example/testkeys:/keys
    environment:
        - KEYSTORE_PASSWORD=passwordpassword

networks:
  evm1:
